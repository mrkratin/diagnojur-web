<div>
  <form [formGroup]="formGroup" novalidate nz-form nzNoColon>
    <nz-card
      [nzBodyStyle]="{ padding: '12px', 'padding-top': '4px' }"
      [nzBordered]="false"
      [nzTitle]="pageHeader"
    >
      <ng-template #pageHeader>
        <nz-page-header
          (nzBack)="onBack()"
          nzBackIcon
          nzTitle="Nova Solicitação de Diagnóstico"
        ></nz-page-header>
      </ng-template>

      <div nz-row>
        <!-- Form -->
        <div
          nz-col
          nzLg="16"
          nzMd="24"
          nzOrder="0"
          nzSm="24"
          nzXXl="18"
          nzXl="16"
          nzXs="24"
        >
          <nz-card
            [nzBodyStyle]="{ padding: '0', 'padding-top': '12px' }"
            [nzBordered]="false"
            nzTitle="Informe sobre seu processo"
          >
            <nz-alert
              [nzMessage]="alertMessage"
              class="px-3 mb-2"
              nzCloseable
              nzShowIcon
              nzType="info"
            >
              <ng-template #alertMessage>
                Dúvidas sobre qual tipo de Diagnóstico escolher?
                <a (click)="showDiagnosisTypes()" class="btn-link" role="button"
                  >Clique aqui</a
                >
              </ng-template>
            </nz-alert>
            <div
              nz-col
              nzLg="12"
              nzMd="12"
              nzSm="12"
              nzXXl="6"
              nzXl="8"
              nzXs="24"
            >
              <nz-form-item>
                <nz-form-label nzFor="process-number"
                  >Número do Processo</nz-form-label
                >
                <nz-form-control>
                  <input
                    [validation]="false"
                    formControlName="processNumber"
                    id="process-number"
                    mask="0000000-00.0000.0.00.0000"
                    nz-input
                    placeholder="NNNNNNN-DD.AAAA.J.TR.OOOO"
                  />
                </nz-form-control>
              </nz-form-item>
            </div>
            <div
              nz-col
              nzLg="12"
              nzMd="12"
              nzSm="12"
              nzXXl="6"
              nzXl="8"
              nzXs="24"
            >
              <nz-form-item>
                <nz-form-label nzFor="county">Comarca / Cidade</nz-form-label>
                <nz-form-control>
                  <button
                    (click)="openSelectCounty()"
                    nz-button
                    nzType="default"
                  >
                    {{ county ? (county | city) : 'Selecionar' }}
                  </button>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzLg="8" nzMd="8" nzSm="8" nzXXl="4" nzXl="8" nzXs="12">
              <nz-form-item>
                <nz-form-label nzFor="solicitation-type"
                  >Tipo de diagnóstico</nz-form-label
                >
                <nz-form-control>
                  <nz-select
                    formControlName="type"
                    id="solicitation-type"
                    nzMode="default"
                    nzPlaceHolder="Tipo de diagnóstico"
                  >
                    <nz-option
                      *ngFor="let t of types"
                      [nzLabel]="t.description"
                      [nzValue]="t.value"
                    ></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div
              *ngIf="formGroup.controls['type'].value === specific"
              nz-col
              nzLg="16"
              nzMd="12"
              nzSm="12"
              nzXXl="8"
              nzXl="8"
              nzXs="24"
            >
              <nz-form-item>
                <nz-form-label nzFor="specific-type"
                  >Tipo de Evento Especifico</nz-form-label
                >
                <nz-form-control>
                  <nz-select
                    formControlName="specificType"
                    id="specific-type"
                    nzMode="default"
                    nzPlaceHolder="Tipo de diagnóstico"
                  >
                    <nz-option
                      *ngFor="let s of sTypes"
                      [nzLabel]="s.description"
                      [nzValue]="s.value"
                    ></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>

            <div nz-col nzLg="8" nzMd="8" nzSm="8" nzXXl="4" nzXl="5" nzXs="12">
              <nz-form-item>
                <nz-form-label nzFor="process-type"
                  ><span
                    >Área do processo
                    <i
                      nz-icon
                      nzType="question-circle"
                      nz-tooltip
                      nzTooltipTitle="O tipo cível abrange os tipos ambiental, previdenciário, tributário, comercial, família e fazenda pública!"
                      nzTheme="outline"
                    ></i
                  ></span>
                </nz-form-label>
                <nz-form-control>
                  <nz-select
                    formControlName="processType"
                    id="process-type"
                    nzMode="default"
                    nzPlaceHolder="Área do processo"
                  >
                    <nz-option
                      *ngFor="let p of pTypes"
                      [nzLabel]="p.description"
                      [nzValue]="p.value"
                    ></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzLg="8" nzMd="8" nzSm="8" nzXXl="4" nzXl="5" nzXs="12">
              <nz-form-item>
                <nz-form-control>
                  <nz-form-label nzFor="justice-type"
                    >Tipo de justiça</nz-form-label
                  >
                  <nz-select
                    formControlName="justiceType"
                    id="justice-type"
                    nzMode="default"
                    nzPlaceHolder="Tipo de justiça"
                  >
                    <nz-option
                      *ngFor="let j of jTypes"
                      [nzLabel]="j.description"
                      [nzValue]="j.value"
                    ></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div
              nz-col
              nzLg="24"
              nzMd="24"
              nzSm="24"
              nzXXl="24"
              nzXl="24"
              nzXs="24"
            >
              <div
                nz-col
                nzLg="8"
                nzMd="8"
                nzSm="8"
                nzXXl="4"
                nzXl="6"
                nzXs="12"
              >
                <nz-form-item>
                  <nz-form-label nzFor="with-lawyer"
                    >Processo com Advogado?</nz-form-label
                  >
                  <nz-form-control>
                    <nz-radio-group
                      (ngModelChange)="clearOAB()"
                      [nzButtonStyle]="'solid'"
                      formControlName="withLawyer"
                      id="with-lawyer"
                    >
                      <label [nzValue]="true" nz-radio-button>Sim</label>
                      <label [nzValue]="false" nz-radio-button>Não</label>
                    </nz-radio-group>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div
                *ngIf="formGroup.controls['withLawyer'].value"
                nz-col
                nzLg="12"
                nzMd="8"
                nzSm="8"
                nzXXl="4"
                nzXl="6"
                nzXs="12"
              >
                <nz-form-item>
                  <nz-form-label nzFor="oab-number"
                    >nº e UF da OAB</nz-form-label
                  >
                  <nz-form-control>
                    <nz-input-group [nzAddOnAfter]="selectUf">
                      <input
                        [validation]="false"
                        formControlName="oabNumber"
                        id="oab-number"
                        mask="0000000"
                        nz-input
                        placeholder="nº OAB"
                        type="text"
                      />
                    </nz-input-group>
                    <ng-template #selectUf>
                      <nz-select formControlName="oabUf" style="width: 75px;">
                        <nz-option
                          *ngFor="let u of ufs"
                          [nzLabel]="u"
                          [nzValue]="u"
                        ></nz-option>
                      </nz-select>
                    </ng-template>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div
                nz-col
                nzLg="8"
                nzMd="8"
                nzSm="8"
                nzXXl="4"
                nzXl="6"
                nzXs="12"
              >
                <nz-form-item>
                  <nz-form-label nzFor="confidential-process"
                    >Processo sigiloso?</nz-form-label
                  >
                  <nz-form-control>
                    <nz-radio-group
                      [nzButtonStyle]="'solid'"
                      (ngModelChange)="clearJusticeSecret()"
                      formControlName="confidentialProcess"
                      id="confidential-process"
                    >
                      <label [nzValue]="true" nz-radio-button>Sim</label>
                      <label [nzValue]="false" nz-radio-button>Não</label>
                    </nz-radio-group>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div
                *ngIf="formGroup.controls['confidentialProcess'].value"
                nz-col
                nzLg="12"
                nzMd="8"
                nzSm="8"
                nzXXl="4"
                nzXl="6"
                nzXs="12"
              >
                <nz-form-item>
                  <nz-form-label nzFor="justice-secret"
                    >Segredo de Justiça</nz-form-label
                  >
                  <nz-form-control>
                    <input
                      formControlName="justiceSecret"
                      id="justice-secret"
                      nz-input
                      placeholder="Segredo de Justiça"
                    />
                  </nz-form-control>
                </nz-form-item>
              </div>
            </div>
          </nz-card>
        </div>

        <!-- Checkout -->
        <div
          nz-col
          nzLg="8"
          nzMd="12"
          nzOrder="1"
          nzSm="16"
          nzXXl="6"
          nzXl="8"
          nzXs="24"
        >
          <nz-card
            [nzBodyStyle]="{ padding: '0', 'padding-top': '12px' }"
            [nzBordered]="false"
            nzTitle="Checkout"
          >
            <nz-list
              [nzDataSource]="['']"
              [nzHeader]="header"
              [nzRenderItem]="listContent"
              nzBordered
            >
              <ng-template #header>
                <h4 class="ant-list-item-meta-title">Seu Pedido</h4>
              </ng-template>
              <ng-template #listContent let-listContent>
                <nz-list-item>
                  <nz-statistic
                    [nzSuffix]="
                      formGroup.controls['type'].value
                        | solicitationType: 'abstract'
                    "
                    [nzTitle]="'Tipo de Diagnóstico'"
                    [nzValue]="
                      formGroup.controls['type'].value | solicitationType
                    "
                  >
                  </nz-statistic>
                </nz-list-item>
                <nz-list-item>
                  <nz-statistic
                    [nzSuffix]="'Nenhum disponível'"
                    [nzTitle]="'Créditos'"
                    [nzValue]="'R$ 0,00'"
                  >
                  </nz-statistic>
                </nz-list-item>
                <nz-list-item>
                  <div
                    nz-col
                    nzLg="24"
                    nzMd="24"
                    nzSm="24"
                    nzXXl="24"
                    nzXl="24"
                    nzXs="24"
                  >
                    <nz-statistic
                      [nzSuffix]="
                        discountCoupon ? discountCoupon.code : 'Nenhum cupom'
                      "
                      [nzTitle]="'Desconto'"
                      [nzValue]="discountCoupon ? 'R$ ' + discount : 'R$ 0,00'"
                      class="mb-1"
                    >
                    </nz-statistic>
                    <nz-input-group
                      [nzAddOnAfter]="suffixButton"
                      nzSearch
                      nzSize="default"
                    >
                      <input
                        nz-input
                        formControlName="discountCoupon"
                        placeholder="Cupom de desconto"
                        type="text"
                      />
                      <small *ngIf="invalidCoupon">Cupon inválido</small>
                    </nz-input-group>
                    <ng-template #suffixButton>
                      <button
                        (click)="applyCoupon()"
                        [nzLoading]="isLoadingCoupon"
                        nz-button
                        nzSearch
                        nzSize="default"
                        nzType="primary"
                      >
                        <i nz-icon type="dollar"></i>Aplicar
                      </button>
                    </ng-template>
                  </div>
                </nz-list-item>
                <nz-list-item>
                  <nz-statistic
                    [nzPrefix]="'R$'"
                    [nzSuffix]="',00'"
                    [nzTitle]="'Total'"
                    [nzValue]="total"
                  >
                  </nz-statistic>
                </nz-list-item>
              </ng-template>
            </nz-list>

            <div
              class="mt-3"
              nz-col
              nzLg="24"
              nzMd="24"
              nzSm="24"
              nzXXl="24"
              nzXl="24"
              nzXs="24"
            >
              <div class="text-center">
                <button
                  (click)="openConfirm()"
                  [disabled]="btnDisable"
                  [nzLoading]="isLoading"
                  nz-button
                  nzSize="large"
                  nzType="primary"
                  type="button"
                >
                  <i nz-icon type="check"></i>Confirmar
                </button>
              </div>
            </div>
          </nz-card>
        </div>
      </div>
    </nz-card>
  </form>
</div>
